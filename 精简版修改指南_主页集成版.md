# bilimiao 精简版修改指南 (主页集成版)

## 目标
将 bilimiao 应用精简为只保留以下核心功能，并将原本的侧滑菜单直接集成到主页：
- ✅ 视频搜索
- ✅ 视频下载
- ✅ 视频播放
- ✅ **主页直接显示搜索/下载入口**

需要移除的功能：
- ❌ 原主页（推荐、热门）
- ❌ 时光机
- ❌ 收藏
- ❌ 追番/追剧
- ❌ 历史记录
- ❌ 稍后看
- ❌ 侧滑菜单覆盖层

---

## 修改步骤

### 1. 创建新的主页 StartPage

**文件**: `bilimiao-compose/src/main/java/cn/a10miaomiao/bilimiao/compose/pages/StartPage.kt`

**内容**:
创建一个新的 Composable 页面，直接包含 `StartViewContent`。

```kotlin
@Serializable
class StartPage : ComposePage() {
    @Composable
    override fun Content() {
        val startViewWrapper by rememberInstance<StartViewWrapper>()
        // ... 配置 PageConfig ...
        StartViewContent(
            // ... 传递参数 ...
            startTopHeight = 10.dp, // 调整顶部间距
            searchAnimation = true
        )
    }
}
```

### 2. 注册 StartPage 路由

**文件**: `bilimiao-compose/src/main/java/cn/a10miaomiao/bilimiao/compose/BilimiaoPageRoute.kt`

**修改内容**:
在 `initRoute` 方法中添加 `StartPage` 的注册：

```kotlin
composable<cn.a10miaomiao.bilimiao.compose.pages.StartPage>()
```

### 3. 替换应用入口点

**文件**: `bilimiao-compose/src/main/java/cn/a10miaomiao/bilimiao/compose/ComposeFragment.kt`

**修改内容**:
1.  将 `MyNavHost` 的起始页设置为 `StartPage()`。
    ```kotlin
    MyNavHost(composeNav, StartPage())
    ```
2.  移除 `MyStartView` 的调用（因为它已经集成到 `StartPage` 中了）。
    ```kotlin
    // MyStartView(startViewWrapper = startViewWrapper) // 已移除
    ```
3.  更新 `goBackHome` 方法：
    ```kotlin
    composeNav.popBackStack(StartPage(), false)
    ```

### 4. 处理其他文件中的引用

- **`DynamicViewModel.kt`**:
    ```kotlin
    nav.navigate(StartPage(), navOptions { ... })
    ```

---

## 编译和测试

### 环境要求
- JDK 17 (Android Gradle Plugin 8.0+ 要求)
- Android SDK 35

### 编译命令

```bash
cd d:\Downloads\BLVD
.\gradlew assembleDebug
```

### 预期效果

应用启动后，将直接显示包含搜索框、用户信息和功能入口的页面。不再需要右滑或点击按钮来打开菜单。页面背景不再是透明覆盖在空白页上，而是作为独立的主页存在。
