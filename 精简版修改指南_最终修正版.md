# bilimiao 精简版修改指南 (最终修正版)

## 目标
将 bilimiao 应用精简为只保留以下核心功能：
- ✅ 视频搜索
- ✅ 视频下载
- ✅ 视频播放

需要移除的功能：
- ❌ 主页（推荐、热门）
- ❌ 时光机
- ❌ 收藏
- ❌ 追番/追剧
- ❌ 历史记录
- ❌ 稍后看

---

## 关键修正：序列化问题

**重要**: `BlankPage` 是一个类 (`class`) 而不是对象 (`object`)。在使用它作为导航参数时，必须实例化它，即使用 `BlankPage()` 而不是 `BlankPage`。否则会导致 `Serializer for class 'Companion' is not found` 崩溃。

---

## 修改步骤

### 1. 精简启动页面的库功能卡片

**文件**: `bilimiao-compose/src/main/java/cn/a10miaomiao/bilimiao/compose/components/start/StartLibraryCard.kt`

**修改内容**:
将整个 `StartLibraryCard` 函数体替换为空实现：

```kotlin
@Composable
fun StartLibraryCard(
    userId: Long?,
    navigateTo: (ComposePage) -> Unit,
) {
    // 精简版：移除所有库功能（收藏、追番、历史、稍后看）
    // 仅保留搜索、下载和播放功能
}
```

---

### 2. 禁用不需要的路由

**文件**: `bilimiao-compose/src/main/java/cn/a10miaomiao/bilimiao/compose/BilimiaoPageRoute.kt`

**修改内容**:
注释掉以下页面的路由注册：
- `HomePage` (主页)
- `TimeSettingPage`, `TimeRegionDetailPage` (时光机)
- `MyBangumiPage`, `MyFollowPage`, `HistoryPage`, `WatchLaterPage` (我的库)

---

### 3. 替换应用入口点 (修正)

**文件**: `bilimiao-compose/src/main/java/cn/a10miaomiao/bilimiao/compose/ComposeFragment.kt`

**修改内容**:
将应用的起始页面从 `HomePage` 替换为 `BlankPage()` 实例。

1.  修改导入：
    ```kotlin
    // 删除 import cn.a10miaomiao.bilimiao.compose.pages.home.HomePage
    import cn.a10miaomiao.bilimiao.compose.pages.BlankPage
    ```

2.  修改 `MyNavHost` 调用：
    ```kotlin
    // MyNavHost(composeNav, HomePage)
    MyNavHost(composeNav, BlankPage()) // 注意这里有括号 ()
    ```

3.  修改 `goBackHome` 方法：
    ```kotlin
    // composeNav.popBackStack(HomePage, false)
    composeNav.popBackStack(BlankPage(), false) // 注意这里有括号 ()
    ```

---

### 4. 处理其他文件中的引用 (修正)

- **`DynamicViewModel.kt`**:
    ```kotlin
    // nav.navigate(HomePage, navOptions { ... })
    nav.navigate(BlankPage(), navOptions { ... }) // 注意这里有括号 ()
    ```

---

## 编译和测试

### 环境要求
- JDK 17 (Android Gradle Plugin 8.0+ 要求)
- Android SDK 35

### 编译命令

```bash
cd d:\Downloads\BLVD
.\gradlew assembleDebug
```

### 生成的 APK 位置

```
app/build/outputs/apk/debug/app-debug.apk
```

---

## 自动化脚本

已提供以下脚本来辅助修改：
- `modify_routes.py`: 修改路由文件
- `modify_compose_fragment.py`: 修改入口文件 (已更新为使用实例)
- `modify_others.py`: 修改其他引用文件 (已更新为使用实例)

运行方法：
```bash
python modify_routes.py
python modify_compose_fragment.py
python modify_others.py
```
